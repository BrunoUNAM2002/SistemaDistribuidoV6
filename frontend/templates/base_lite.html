<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema de Emergencias M√©dicas{% endblock %} - Sala {{ node_id }}</title>

    <!-- OPTIMIZED: Only custom CSS, NO external CDN dependencies -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/medzoon-lite.css') }}">

    <!-- Inline critical SVG icons (instead of 110KB Bootstrap Icons) -->
    <style>
        /* Critical CSS for above-the-fold content */
        .loading { opacity: 0; animation: fadeIn 0.3s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
    </style>
</head>
<body class="loading">
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <!-- Heart pulse SVG icon (inline, 0.5KB) -->
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        <path d="M12 5.67v15.56"/>
                        <path d="M8 12h8"/>
                    </svg>
                </div>
                <h2 class="sidebar-title">MediSys</h2>
                <p class="sidebar-subtitle">Emergency Management System</p>
            </div>

            <!-- Navigation -->
            <nav class="sidebar-nav">
                {% if user_info and user_info['rol'] == 'trabajador_social' %}
                <a href="{{ url_for('visitas.index') }}" class="nav-link">
                    <span class="nav-icon">üìã</span>
                    <span>Registro de Visitas</span>
                </a>
                {% endif %}

                {% if user_info and user_info['rol'] == 'doctor' %}
                <a href="{{ url_for('consultas.mis_consultas') }}" class="nav-link">
                    <span class="nav-icon">ü©∫</span>
                    <span>Mis Consultas</span>
                </a>
                {% endif %}

                {% if user_info and user_info['rol'] == 'admin' %}
                <a href="#" class="nav-link">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Administraci√≥n</span>
                </a>
                <a href="#" class="nav-link">
                    <span class="nav-icon">üë•</span>
                    <span>Usuarios</span>
                </a>
                {% endif %}

                <a href="{{ url_for('logout') }}" class="nav-link">
                    <span class="nav-icon">üö™</span>
                    <span>Salir</span>
                </a>
            </nav>

            <!-- User Card -->
            <div class="sidebar-footer">
                {% if current_user.is_authenticated and user_info %}
                <div class="user-card">
                    <div class="user-avatar">
                        {{ (user_info.get('nombre') or user_info['username'])[0]|upper }}
                    </div>
                    <div class="user-info">
                        <p class="user-name">{{ user_info.get('nombre') or user_info['username']|title }}</p>
                        <p class="user-role">
                            {% if user_info['rol'] == 'admin' %}Administrador
                            {% elif user_info['rol'] == 'doctor' %}Doctor
                            {% else %}Trabajador Social
                            {% endif %}
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div>
                    <strong>Nodo {{ node_id }}</strong>
                    <span class="badge badge-success">Activo</span>
                </div>
                <div class="topbar-actions">
                    <span>Puerto: {{ flask_port }}</span>
                </div>
            </div>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }}" role="alert">
                            {{ message }}
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Page Content -->
                {% block content %}{% endblock %}
            </div>

            <!-- Footer -->
            <footer class="footer">
                <div class="container">
                    <div class="footer-content">
                        <p class="footer-text">
                            ¬© 2025 MediSys Emergency Management System
                        </p>
                        <p class="footer-text">
                            Nodo {{ node_id }} | Puerto {{ flask_port }}
                        </p>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- OPTIMIZED: Only essential JavaScript, NO jQuery, NO Bootstrap JS -->
    <script src="{{ url_for('static', filename='js/animations-lite.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socketio.js') }}"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    {% block scripts %}{% endblock %}
</body>
</html>
